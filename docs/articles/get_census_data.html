<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting Data from the US Census Bureau for Isochrones • tyler</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting Data from the US Census Bureau for Isochrones">
<meta name="description" content="A wrapper on the amazing censusapi package to get US Census Bureau data for women only.
">
<meta property="og:description" content="A wrapper on the amazing censusapi package to get US Census Bureau data for women only.
">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tyler</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>TRUE</h6></li>
    <li><a class="dropdown-item" href="../articles/create_isochrones.html">Gathering Drive Time Isochrones</a></li>
    <li><a class="dropdown-item" href="../articles/geocode.html">Geocoding</a></li>
    <li><a class="dropdown-item" href="../articles/get_census_data.html">Getting Data from the US Census Bureau for Isochrones</a></li>
    <li><a class="dropdown-item" href="../articles/imotive-news.html">Imotive News &amp; Changelog</a></li>
    <li><a class="dropdown-item" href="../articles/my-vignette.html">Searching the NPI Database Starting with Taxonomy Codes</a></li>
    <li><a class="dropdown-item" href="../articles/search_and_process_npi.html">Search and Process NPI Numbers</a></li>
    <li><a class="dropdown-item" href="../articles/aggregating_provider_data.html">Aggregating Provider Data for Analysis</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html#datasets">Datasets</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mufflyt/tyler/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Getting Data from the US Census Bureau for Isochrones</h1>
                        <h4 data-toc-skip class="author">Tyler Muffly,
MD</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mufflyt/tyler/blob/HEAD/vignettes/get_census_data.Rmd" class="external-link"><code>vignettes/get_census_data.Rmd</code></a></small>
      <div class="d-none name"><code>get_census_data.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette demonstrates the usage of the
<code>get_census_data</code> function, which is designed to retrieve
Census data for all states’ block groups. It leverages the
<code>censusapi</code> package to query the U.S. Census Bureau’s API and
collect demographic information for specified state FIPS codes. We’ll
get the population in each block group using the <a href="https://www.hrecht.com/censusapi/" class="external-link">censusapi</a> library and this
relies heavily on her vignette.</p>
<div class="section level4">
<h4 id="centers-for-medicare-and-medicaid-services-doctors-and-clinicians-downloadable-file">Centers for Medicare and Medicaid Services Doctors and Clinicians
Downloadable file<a class="anchor" aria-label="anchor" href="#centers-for-medicare-and-medicaid-services-doctors-and-clinicians-downloadable-file"></a>
</h4>
<p>The Downloadable File is housed in the CMS Medicare Compare (aka
Physician Compare site): <a href="https://data.cms.gov/provider-data/dataset/mj5m-pzi6" class="external-link">CMS Medicare
Compare</a>. We could have downloaded the full data set file and do a
left join but that runs the risk of being out of date give the data is
update monthly. Here is the data dictionary for the file: <a href="https://data.cms.gov/provider-data/sites/default/files/data_dictionaries/physician/DOC_Data_Dictionary.pdf" class="external-link">CMS
Medicare Compare Data Dictionar</a>. The Doctors and Clinicians national
downloadable file is organized at the individual clinician level; each
line is unique at the clinicianenrollment record-group-address
(NPI-Ind_enrl_ID-Org_PAC_ID-adrs_id) level. Clinicians with multiple
Medicare enrollment records and/or single enrollments linking to
multiple practice locations are listed on multiple lines.</p>
</div>
<div class="section level4">
<h4 id="state-federal-information-processing-standards-codes">State Federal Information Processing Standards Codes<a class="anchor" aria-label="anchor" href="#state-federal-information-processing-standards-codes"></a>
</h4>
<p>This function retrieves Census data using censusapi for all states’
block groups by looping over the specified list of state FIPS codes.
This only brings back data on females from “B01001_01, 26, 33:49E”. FIPS
codes, or Federal Information Processing Standards codes, are a
standardized set of codes used to uniquely identify geographic areas in
the United States. These codes are assigned to various administrative
and geographical entities, such as states, counties, cities, and more.
We used block groups for the analysis.</p>
<p>The GEOID for block groups in the United States can be constructed
using the following format: STATECOUNTYTRACTBLOCK_GROUP. Specifically: *
STATE is a 2-digit code for the state. * COUNTY is a 3-digit code for
the county. * TRACT is a 6-digit code for the census tract. *
BLOCK_GROUP is a 1-digit code for the block group within the tract.</p>
</div>
<div class="section level4">
<h4 id="block-group-as-the-unit-of-measurement">Block Group as the Unit of Measurement<a class="anchor" aria-label="anchor" href="#block-group-as-the-unit-of-measurement"></a>
</h4>
<p>In the United States Census Bureau’s geographic hierarchy, a “block
group” is a smaller and more detailed geographic unit used for
collecting and reporting demographic and statistical data. Block groups
are subdivisions of census tracts and are typically designed to contain
between 600 and 3,000 people, although this can vary depending on the
population density of the area. Census block group borders are defined
based on visible and easily identifiable features such as roads, rivers,
streets, or natural boundaries like mountains and parks. The Census
Bureau aims to create block group boundaries that follow these features
to make them easily distinguishable.</p>
<p>Block groups are used as the primary units for collecting detailed
demographic and socioeconomic data during the decennial census and the
American Community Survey (ACS). Census enumerators visit households
within each block group to collect information on population, housing,
employment, income, education, and more. In a densely populated urban
area, a block group might represent a city block or a small neighborhood
within a larger city. For example, a block group could cover a few city
blocks in downtown Manhattan, New York City.</p>
</div>
</div>
<div class="section level2">
<h2 id="data-from-the-us-census-bureau">Data From the US Census Bureau<a class="anchor" aria-label="anchor" href="#data-from-the-us-census-bureau"></a>
</h2>
<p>These variables are part of a dataset obtained from the U.S. Census
Bureau’s American Community Survey (ACS). The U.S. Census Bureau’s
American Community Survey (ACS) is an ongoing nationwide survey
conducted by the United States Census Bureau. It is designed to collect
and provide detailed demographic, social, economic, and housing
information about the American population. Here are some key features
and aspects of the ACS:</p>
<ul>
<li><p>Continuous Survey: The ACS is conducted continuously throughout
the year, providing updated and current data. Unlike the decennial
census, which occurs every ten years, the ACS is conducted annually,
allowing for more frequent and timely information.</p></li>
<li><p>Sampling: The ACS uses a sample-based approach to collect data
from a representative subset of the U.S. population. The sample includes
households and individuals from all 50 states, the District of Columbia,
and Puerto Rico.</p></li>
<li><p>Questionnaire: Respondents are asked to complete a detailed
questionnaire that covers a wide range of topics, including demographics
(age, sex, race, etc.), housing characteristics, education, employment,
income, health insurance, and more.</p></li>
<li><p>Geographic Coverage: The ACS provides data at various geographic
levels, including national, state, county, city, town, and even census
tract or block group. This allows for detailed analysis of communities
and regions.</p></li>
<li><p>Data Release: The ACS releases data in various forms, including
one-year estimates, three-year estimates, and five-year estimates.
One-year estimates are available for areas with larger populations,
while three-year and five-year estimates are designed for smaller areas
and subpopulations. The five-year estimates provide the most reliable
data for small geographic areas and specific demographic
groups.</p></li>
<li><p>Accessibility: ACS data is publicly accessible and can be
accessed through the Census Bureau’s website, data.census.gov, and other
data dissemination platforms. Researchers, policymakers, businesses, and
the general public use ACS data for various purposes, including policy
development, market research, and community planning.</p></li>
<li><p>Importance: The ACS is a critical tool for understanding the
changing demographics and socio-economic characteristics of the U.S.
population. It is used for congressional apportionment, resource
allocation, grant distribution, and various research purposes.</p></li>
<li><p>Privacy and Confidentiality: The Census Bureau takes privacy and
confidentiality seriously. Personal information collected in the ACS
questionnaire is protected by law, and responses are aggregated to
ensure that individual respondents cannot be identified.</p></li>
<li><p>Census Long Form Replacement: The ACS was introduced to replace
the long-form questionnaire that was part of the decennial census. The
long-form collected detailed demographic and housing information, and
the ACS continues to provide this valuable data on an ongoing
basis.</p></li>
</ul>
<p>They represent demographic information for block groups within
various states. Here’s an explanation of each variable:</p>
<ul>
<li>
<code>name</code>: This variable represents the name or label of the
block group.</li>
<li>
<code>total_females</code>: It represents the total number of
females in the block group.</li>
<li>
<code>female_21_yo</code>: This variable represents the number of
females aged 21 years and older in the block group.</li>
<li>
<code>female_22_to_24_years</code>: It represents the number of
females aged 22 to 24 years in the block group.</li>
<li>
<code>female_25_to_29_years</code>: This variable represents the
number of females aged 25 to 29 years in the block group.</li>
<li>
<code>female_30_to_34_years</code>: It represents the number of
females aged 30 to 34 years in the block group.</li>
<li>etc.</li>
</ul>
<pre><code>    name = NAME,
    total_females = B01001_026E,
    female_21_yo = B01001_033E,
    female_22_to_24_years = B01001_034E,
    female_25_to_29_years = B01001_035E,
    female_30_to_34_years = B01001_036E,
    female_35_to_39_years = B01001_037E,
    female_40_to_44_years = B01001_038E,
    female_45_to_49_years = B01001_039E,
    female_50_to_54_years = B01001_040E,
    female_55_to_59_years = B01001_041E,
    female_60_to_61_years = B01001_042E,
    female_62_to_64_years = B01001_043E,
    female_65_to_66_years = B01001_044E,
    female_67_to_69_years = B01001_045E,
    female_70_to_74_years = B01001_046E,
    female_75_to_79_years = B01001_047E,
    female_80_to_84_years = B01001_048E,
    female_85_years_and_older = B01001_049E,
    fips_state = state</code></pre>
<p>Eventually these data will be matched onto the Block Groups. The
block group shapefile is from the 2021 ACS via <a href="https://www.nhgis.org/" class="external-link">National Historical Geographic Information
System (NHGIS)</a>. To calculate how many people live within and outside
of the drive time isochrones, we’ll need to identify the percent of each
Census block group that lies within the isochrones.</p>
</div>
<div class="section level2">
<h2 id="function-description">Function Description<a class="anchor" aria-label="anchor" href="#function-description"></a>
</h2>
<p>The get_census_data function retrieves Census data for all states’
block groups. Here’s a brief description of its parameters:</p>
<p><code>us_fips</code>: A vector of state FIPS (Federal Information
Processing Standards) codes. Each code uniquely identifies a U.S. state.
For example, Colorado is represented by the FIPS code 08.</p>
<p>The resulting data is combined into a single dataframe for
analysis.</p>
<div class="section level3">
<h3 id="step-1">Step 1<a class="anchor" aria-label="anchor" href="#step-1"></a>
</h3>
<div class="section level4">
<h4 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h4>
<p>Before using the <code><a href="../reference/get_census_data.html">tyler::get_census_data</a></code> function, you
need to install and load the required packages. You can do this by
running the following code:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install and load the necessary packages</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"censusapi"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.hrecht.com/censusapi/" class="external-link">censusapi</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mufflyt.github.io/mystery/" class="external-link">tyler</a></span><span class="op">)</span></span></code></pre></div>
<p>These lists contain metadata about general variables and the
variables related to race and ethnicity.</p>
<div class="section level5">
<h5 id="all-variables">All Variables<a class="anchor" aria-label="anchor" href="#all-variables"></a>
</h5>
<pre><code>acs_vars &lt;- censusapi::listCensusMetadata(name = "acs/acs5", 
      vintage = 2019, group = "B01001") %&gt;% 
      readr::write_csv("data/acs_vars.csv")
      
# This code cleans it up a bit
acs_vars &lt;- acs_vars %&gt;%
  dplyr::select(-predicateType, -group, -limit, -predicateOnly) %&gt;%
  dplyr::filter(!stringr::str_detect(label, fixed("!!Male:!!", ignore_case = TRUE))) %&gt;%
  dplyr::filter(!stringr::str_detect(label, fixed("Annotation of Margin of Error", ignore_case = TRUE))) %&gt;%
  dplyr::mutate(label = stringr::str_remove(label, regex("^Annotation of Estimate!!Total:!!Female:!!", ignore_case = TRUE))) %&gt;%
  dplyr::filter(!stringr::str_detect(label, fixed("Margin of Error!!", ignore_case = TRUE))) %&gt;%
  dplyr::mutate(label = stringr::str_remove(label, regex("^Annotation of Estimate!!Total:!!Female:!!", ignore_case = TRUE))) %&gt;%
  dplyr::mutate(label = stringr::str_remove(label, regex("^Estimate!!Total:!!Female:!!", ignore_case = TRUE))) %&gt;%
  dplyr::filter(!stringr::str_detect(name, fixed("EA")) &amp; !str_detect(label, fixed("!!Male:"))) %&gt;%
  dplyr::mutate(numbers = purrr::map_chr(str_extract_all(label, "^[:digit:]+"), ~ ifelse(length(.) == 0, NA_character_, paste(.x, collapse = "")))) %&gt;%
  dplyr::mutate(numbers = as.numeric(numbers)) %&gt;%
  dplyr::mutate(numbers = tidyr::replace_na(numbers, 0)) %&gt;%
  dplyr::mutate(numbers = as.numeric(numbers)) %&gt;%
  dplyr::arrange(numbers)
  
&gt; acs_vars
          name                     label    concept numbers
1  B01001_026E Estimate!!Total:!!Female: SEX BY AGE       0
2  B01001_027E             Under 5 years SEX BY AGE       0
3  B01001_001E          Estimate!!Total: SEX BY AGE       0
4  B01001_028E              5 to 9 years SEX BY AGE       5
5  B01001_029E            10 to 14 years SEX BY AGE      10</code></pre>
</div>
<div class="section level5">
<h5 id="race-variables">Race Variables<a class="anchor" aria-label="anchor" href="#race-variables"></a>
</h5>
<pre><code>acs_race_vars &lt;- censusapi::listCensusMetadata(name = "acs/acs5", 
      vintage = 2019, group = "B02001") %&gt;%
      readr::write_csv("data/acs_race_vars.csv")

#output:
&gt; acs_race_vars
# A tibble: 40 × 7
   name         label                                                      concept predicateType group limit predicateOnly
   &lt;chr&gt;        &lt;chr&gt;                                                      &lt;chr&gt;   &lt;chr&gt;         &lt;chr&gt; &lt;dbl&gt; &lt;lgl&gt;        
 1 B02001_010EA Annotation of Estimate!!Total:!!Two or more races:!!Two r… RACE    string        B020…     0 TRUE         
 2 B02001_010MA Annotation of Margin of Error!!Total:!!Two or more races:… RACE    string        B020…     0 TRUE         
 3 B02001_001EA Annotation of Estimate!!Total:                             RACE    string        B020…     0 TRUE         
 4 B02001_001MA Annotation of Margin of Error!!Total:                      RACE    string        B020…     0 TRUE         
 5 B02001_004EA Annotation of Estimate!!Total:!!American Indian and Alask… RACE    string        B020…     0 TRUE         
 6 B02001_004MA Annotation of Margin of Error!!Total:!!American Indian an… RACE    string        B020…     0 TRUE         
 7 B02001_005EA Annotation of Estimate!!Total:!!Asian alone                RACE    string        B020…     0 TRUE         
 8 B02001_005MA Annotation of Margin of Error!!Total:!!Asian alone         RACE    string        B020…     0 TRUE         
 9 B02001_002EA Annotation of Estimate!!Total:!!White alone                RACE    string        B020…     0 TRUE         
10 B02001_002MA Annotation of Margin of Error!!Total:!!White alone         RACE    string        B020…     0 TRUE  </code></pre>
</div>
<div class="section level5">
<h5 id="race-and-ethnicity-variables">Race and Ethnicity Variables<a class="anchor" aria-label="anchor" href="#race-and-ethnicity-variables"></a>
</h5>
<pre><code><span><span class="va">acs_raceeth_vars</span> <span class="op">&lt;-</span> <span class="fu">censusapi</span><span class="fu">::</span><span class="fu"><a href="https://www.hrecht.com/censusapi/reference/listCensusMetadata.html" class="external-link">listCensusMetadata</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"acs/acs5"</span>, </span>
<span>      vintage <span class="op">=</span> <span class="fl">2019</span>, group <span class="op">=</span> <span class="st">"B03002"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="st">"data/acs_raceeth_vars.csv"</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
<div class="section level3">
<h3 id="step-2-prepare-your-data">Step 2: Prepare Your Data<a class="anchor" aria-label="anchor" href="#step-2-prepare-your-data"></a>
</h3>
<p>Define a vector of state FIPS codes. For example, you can use the
tigris package to obtain FIPS codes for all U.S. states:</p>
<pre><code><span><span class="va">us_fips_list</span> <span class="op">&lt;-</span> <span class="fu">tigris</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/tigris/man/fips_codes.html" class="external-link">fips_codes</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">state_code</span>, <span class="va">state_name</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">state_code</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">state_code</span> <span class="op">&lt;</span> <span class="fl">56</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>                         <span class="co">#state_codes over 56 are territories</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">state_code</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="op">)</span>                                              </span>
<span></span>
<span><span class="co"># All US State FIPS Codes</span></span>
<span><span class="va">us_fips_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"01"</span>, <span class="st">"02"</span>, <span class="st">"04"</span>, <span class="st">"05"</span>, <span class="st">"06"</span>, <span class="st">"08"</span>, <span class="st">"09"</span>, <span class="st">"10"</span>, <span class="st">"11"</span>, <span class="st">"12"</span>, <span class="st">"13"</span>, <span class="st">"15"</span>, <span class="st">"16"</span>, <span class="st">"17"</span>, <span class="st">"18"</span>, <span class="st">"19"</span>, <span class="st">"20"</span>, <span class="st">"21"</span>, <span class="st">"22"</span>, <span class="st">"23"</span>, <span class="st">"24"</span>, <span class="st">"25"</span>, <span class="st">"26"</span>, <span class="st">"27"</span>, <span class="st">"28"</span>, <span class="st">"29"</span>, <span class="st">"30"</span>, <span class="st">"31"</span>, <span class="st">"32"</span>, <span class="st">"33"</span>, <span class="st">"34"</span>, <span class="st">"35"</span>, <span class="st">"36"</span>, <span class="st">"37"</span>, <span class="st">"38"</span>, <span class="st">"39"</span>, <span class="st">"40"</span>, <span class="st">"41"</span>, <span class="st">"42"</span>, <span class="st">"44"</span>, <span class="st">"45"</span>, <span class="st">"46"</span>, <span class="st">"47"</span>, <span class="st">"48"</span>, <span class="st">"49"</span>, <span class="st">"50"</span>, <span class="st">"51"</span>, <span class="st">"53"</span>, <span class="st">"54"</span>, <span class="st">"55"</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="step-3-gather-the-data-from-the-us-census-bureau-api">Step 3: Gather the Data from the US Census Bureau API<a class="anchor" aria-label="anchor" href="#step-3-gather-the-data-from-the-us-census-bureau-api"></a>
</h3>
<p>Call the <code>get_census_data</code> function with the
<code>us_fips_list</code> vector. The helper adds 2020 Federal
Information Processing Standard (FIPS) identifiers for every geography
plus the Census vintage so you always know which release supplied the
estimates. For example:</p>
<pre><code><span><span class="va">all_census_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_census_data.html">get_census_data</a></span><span class="op">(</span>us_fips_list <span class="op">=</span> <span class="va">us_fips_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##########################################################################</span></span>
<span><span class="co"># Get Census data by block group in relevant states</span></span>
<span><span class="co"># Construct: for=block group:*&amp;in=state:01&amp;in=county:*&amp;in=tract:*</span></span>
<span><span class="co">###########################################################################</span></span>
<span></span>
<span><span class="co">#output GOES HERE!!!!</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="step-4-the-function-will-retrieve-census-data-for-all-specified-states-and-combine-it-into-a-single-dataframe-which-you-can-use-for-further-analysis-">Step 4: The function will retrieve Census data for all specified
states and combine it into a single dataframe, which you can use for
further analysis.<a class="anchor" aria-label="anchor" href="#step-4-the-function-will-retrieve-census-data-for-all-specified-states-and-combine-it-into-a-single-dataframe-which-you-can-use-for-further-analysis-"></a>
</h3>
<pre><code><span><span class="va">demographics_bg</span> <span class="op">&lt;-</span> <span class="va">acs_block_group</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>    total_females <span class="op">=</span> <span class="va">B01001_026E</span>,</span>
<span>    female_21_yo <span class="op">=</span> <span class="va">B01001_033E</span>,</span>
<span>    female_22_to_24_years <span class="op">=</span> <span class="va">B01001_034E</span>,</span>
<span>    female_25_to_29_years <span class="op">=</span> <span class="va">B01001_035E</span>,</span>
<span>    female_30_to_34_years <span class="op">=</span> <span class="va">B01001_036E</span>,</span>
<span>    female_35_to_39_years <span class="op">=</span> <span class="va">B01001_037E</span>,</span>
<span>    female_40_to_44_years <span class="op">=</span> <span class="va">B01001_038E</span>,</span>
<span>    female_45_to_49_years <span class="op">=</span> <span class="va">B01001_039E</span>,</span>
<span>    female_50_to_54_years <span class="op">=</span> <span class="va">B01001_040E</span>,</span>
<span>    female_55_to_59_years <span class="op">=</span> <span class="va">B01001_041E</span>,</span>
<span>    female_60_to_61_years <span class="op">=</span> <span class="va">B01001_042E</span>,</span>
<span>    female_62_to_64_years <span class="op">=</span> <span class="va">B01001_043E</span>,</span>
<span>    female_65_to_66_years <span class="op">=</span> <span class="va">B01001_044E</span>,</span>
<span>    female_67_to_69_years <span class="op">=</span> <span class="va">B01001_045E</span>,</span>
<span>    female_70_to_74_years <span class="op">=</span> <span class="va">B01001_046E</span>,</span>
<span>    female_75_to_79_years <span class="op">=</span> <span class="va">B01001_047E</span>,</span>
<span>    female_80_to_84_years <span class="op">=</span> <span class="va">B01001_048E</span>,</span>
<span>    female_85_years_and_older <span class="op">=</span> <span class="va">B01001_049E</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    population <span class="op">=</span> <span class="va">female_21_yo</span> <span class="op">+</span> <span class="va">female_22_to_24_years</span> <span class="op">+</span> <span class="va">female_25_to_29_years</span> <span class="op">+</span></span>
<span>      <span class="va">female_30_to_34_years</span> <span class="op">+</span> <span class="va">female_35_to_39_years</span> <span class="op">+</span> <span class="va">female_40_to_44_years</span> <span class="op">+</span></span>
<span>      <span class="va">female_45_to_49_years</span> <span class="op">+</span></span>
<span>      <span class="va">female_50_to_54_years</span> <span class="op">+</span></span>
<span>      <span class="va">female_55_to_59_years</span> <span class="op">+</span></span>
<span>      <span class="va">female_60_to_61_years</span> <span class="op">+</span></span>
<span>      <span class="va">female_62_to_64_years</span> <span class="op">+</span></span>
<span>      <span class="va">female_65_to_66_years</span> <span class="op">+</span></span>
<span>      <span class="va">female_67_to_69_years</span> <span class="op">+</span></span>
<span>      <span class="va">female_70_to_74_years</span> <span class="op">+</span></span>
<span>      <span class="va">female_75_to_79_years</span> <span class="op">+</span></span>
<span>      <span class="va">female_80_to_84_years</span> <span class="op">+</span></span>
<span>      <span class="va">female_85_years_and_older</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co">#total of reproductive age women</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">statefp</span>, <span class="va">countyfp</span>, <span class="va">tractce</span>, <span class="va">block_group</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="va">geoid</span>,</span>
<span>    <span class="va">statefp</span>,</span>
<span>    <span class="va">countyfp</span>,</span>
<span>    <span class="va">tractce</span>,</span>
<span>    <span class="va">block_group</span>,</span>
<span>    <span class="va">vintage</span>,</span>
<span>    <span class="va">name</span>,</span>
<span>    <span class="va">population</span>,</span>
<span>    <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"B"</span><span class="op">)</span>, <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"universe"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">demographics_bg</span><span class="op">)</span></span>
<span></span>
<span><span class="va">demographics_bg</span> <span class="op">&lt;-</span> <span class="va">demographics_bg</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">geoid</span><span class="op">)</span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu">write.csv</span><span class="op">(</span><span class="va">demographics_bg</span>, <span class="st">"data/acs-block-group-demographics.csv"</span>, na <span class="op">=</span> <span class="st">""</span>, row.names <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">write_rds</a></span><span class="op">(</span><span class="va">demographics_bg</span>, <span class="st">"data/acs-block-group-demographics.rds"</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="step-5-join-the-data-to-the-block-groups">Step 5: Join the Data to the Block Groups<a class="anchor" aria-label="anchor" href="#step-5-join-the-data-to-the-block-groups"></a>
</h3>
<p>The code starts by loading a block group shapefile using the
<code><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">sf::st_read()</a></code> function. The shapefile path should be
replaced with the actual file path. A left join is performed between the
“demographics_bg” dataset and the “bg_shape” dataset using
<code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">dplyr::left_join()</a></code>. The join is based on matching the
“<code>geoid</code>” column from “<code>demographics_bg</code>” and the
“<code>GEOID</code>” column from “<code>bg_shape</code>”. Always join on
the GEOID rather than the human-readable name to avoid mismatches across
vintages.</p>
<pre><code># Load the block group shapefile using sf::st_read() function
# Replace "/data/shp/block_group/" with the actual file path to the shapefile
bg_shape &lt;- sf::st_read(/data/shp/block_group/") %&gt;%

  # Select only the GEOID and geometry columns from the shapefile
  dplyr::select(GEOID, geometry)

# Write the block group shapefile with selected columns to a CSV file
# This will create a CSV file with GEOID and geometry information
bg_shape %&gt;%
  readr::write_csv("bg_shape_with_geometry.csv")


# Ensure the GEOID columns are character for the join
demographics_bg$geoid &lt;- as.character(demographics_bg$geoid)


# Perform a left join between the demographics dataset and the block group shapefile
# Join the datasets using the "fips_block_group" column from demographics_bg
# and the "GEOID" column from bg_shape

geometry &lt;- dplyr::left_join(x = demographics_bg, 
          y = bg_shape, 
          by = c("fips_block_group" = "GEOID"))</code></pre>
<pre><code><span><span class="co"># Write the resulting dataset with geometry information to a CSV file</span></span>
<span><span class="co"># This will create a CSV file containing demographic data and geometry information</span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">geometry</span>, <span class="st">"block_groups_with_geometry.csv"</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="step-6-get-data-regarding-race-and-ethnicity">Step 6: Get Data regarding Race and Ethnicity<a class="anchor" aria-label="anchor" href="#step-6-get-data-regarding-race-and-ethnicity"></a>
</h3>
</div>
</div>
<div class="section level2">
<h2 id="usage-tips">Usage Tips<a class="anchor" aria-label="anchor" href="#usage-tips"></a>
</h2>
<ul>
<li><p>Ensure that you have a valid Census API key to access the data.
Replace <code>"your_census_api_key_here"</code> with your actual API key
in the function call.</p></li>
<li><p>We included a one second pause in the function loop to be mindful
of rate limiting and API usage policies when making multiple requests to
the Census Bureau’s API.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>The <code>get_census_data</code> function simplifies the process of
obtaining Census data for all states’ block groups.</p>
</div>
<div class="section level2">
<h2 id="features-and-bugs">Features and bugs<a class="anchor" aria-label="anchor" href="#features-and-bugs"></a>
</h2>
<p>If you have ideas for other features that would make name handling
easier, or find a bug, the best approach is to either report it or add
it!</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tyler Muffly.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
